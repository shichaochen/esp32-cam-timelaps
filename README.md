# ESP32-CAM 定时拍摄项目

这是一个基于ESP32-CAM的定时拍摄项目，每10分钟自动拍摄一张高分辨率照片并保存到TF卡中。

## 功能特性

- ✅ 每10分钟自动拍摄一张照片
- ✅ 高分辨率拍摄（UXGA 1600x1200，如果支持PSRAM）
- ✅ **首次自动配置WiFi** - 无需修改代码，通过Web界面配置
- ✅ 自动Wi-Fi连接（配置后自动保存）
- ✅ NTP时间同步
- ✅ 使用时间戳作为文件名（格式：`2025_10_12_18:15.jpg`）
- ✅ 照片保存到TF卡
- ✅ 深度睡眠模式节省功耗

## 硬件要求

- ESP32-CAM开发板
- TF卡（MicroSD卡）
- USB转串口模块（用于初始编程）
- 5V电源适配器（用于长期运行）

## 软件要求

- **Arduino IDE** (推荐) 或 PlatformIO IDE
- ESP32开发板支持包

## Arduino IDE 安装步骤

### 1. 安装ESP32开发板支持

1. 打开Arduino IDE
2. 进入 `文件` → `首选项`
3. 在"附加开发板管理器网址"中添加：
   ```
   https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
   ```
4. 进入 `工具` → `开发板` → `开发板管理器`
5. 搜索"esp32"，安装"esp32 by Espressif Systems"

### 2. 安装必要的库

进入 `工具` → `管理库`，搜索并安装：
- **esp32-camera** (by Espressif)

**注意**：其他库（WiFi、WebServer、Preferences）已包含在ESP32核心库中，无需单独安装。

### 3. 选择开发板和端口

- 开发板：`工具` → `开发板` → `ESP32 Arduino` → `AI Thinker ESP32-CAM`
- 端口：选择正确的COM端口
- 上传速度：115200（如果上传失败，可以尝试降低）

## 首次WiFi配置（重要！）

### 方法一：Web界面配置（推荐，无需修改代码）

1. **上传程序到ESP32-CAM**
   - 上传时需要按住BOOT按钮，然后按一下RESET按钮，直到开始上传
   
2. **首次启动会自动进入配置模式**
   - 设备会创建一个WiFi热点：`ESP32-CAM-Config`
   - 密码：`12345678`

3. **连接配置热点**
   - 用手机或电脑连接到 `ESP32-CAM-Config` WiFi网络
   - 输入密码：`12345678`

4. **打开配置页面**
   - 在浏览器中访问：`http://192.168.4.1`
   - 或自动弹出配置页面

5. **填写WiFi信息**
   - 输入您的WiFi名称（SSID）
   - 输入您的WiFi密码
   - 点击"保存配置"

6. **等待重启**
   - 设备会自动保存配置并重启
   - 重启后会连接到您配置的WiFi网络
   - 之后每次启动都会自动连接，无需再次配置

### 方法二：清除配置重新配置

如果需要重新配置WiFi，可以：
- 清除Flash中的配置数据（通过Arduino IDE的"擦除Flash"功能）
- 或者修改代码中的AP密码后重新上传（会触发重新配置）

## 配置步骤

### 1. 修改时区设置（可选）

如果需要修改时区，在 `src/main.cpp` 中修改以下配置：

```cpp
const long gmtOffset_sec = 8 * 3600;  // GMT+8 (北京时间)
```

例如：
- GMT+8（北京时间）：`8 * 3600`
- GMT+0（伦敦时间）：`0`
- GMT-5（纽约时间）：`-5 * 3600`

### 2. 修改配置AP信息（可选）

如果需要修改配置热点的名称和密码，在 `src/main.cpp` 中修改：

```cpp
const char* ap_ssid = "ESP32-CAM-Config";  // 配置热点名称
const char* ap_password = "12345678";      // 配置热点密码（至少8位）
```

### 3. 修改拍摄间隔（可选）

默认是15分钟，如需修改，更改以下配置：

```cpp
#define SLEEP_DURATION_US (15 * 60 * 1000000ULL)  // 15分钟
```

例如：
- 10分钟：`(10 * 60 * 1000000ULL)`
- 30分钟：`(30 * 60 * 1000000ULL)`
- 1小时：`(60 * 60 * 1000000ULL)`

## 编译和上传

### 使用Arduino IDE（推荐）

1. 打开 `src/main.cpp` 文件（或将其内容复制到Arduino IDE的新文件中）
2. 确保已安装ESP32开发板支持包和esp32-camera库
3. 选择开发板：`工具` → `开发板` → `ESP32 Arduino` → `AI Thinker ESP32-CAM`
4. 选择正确的串口
5. 点击"上传"按钮

**上传技巧**：
- 上传时需要按住ESP32-CAM的**BOOT按钮**
- 然后按一下**RESET按钮**
- 松开BOOT按钮，等待上传开始
- 如果上传失败，可以尝试降低上传速度（在工具菜单中）

### 使用PlatformIO

1. 打开项目文件夹
2. 连接ESP32-CAM到电脑
3. 点击PlatformIO的"Upload"按钮
4. 等待编译和上传完成

## 使用方法

### 首次使用

1. **插入TF卡**到ESP32-CAM
2. **上传程序**到ESP32-CAM（参考上面的上传步骤）
3. **配置WiFi**（参考"首次WiFi配置"章节）
   - 连接到 `ESP32-CAM-Config` 热点
   - 访问 `http://192.168.4.1` 配置WiFi
4. **完成配置后**，设备会自动：
   - 连接到您配置的WiFi
   - 同步NTP时间
   - 拍摄第一张照片
   - 进入深度睡眠10分钟
   - 每10分钟自动醒来重复拍摄

### 日常使用

配置完成后，每次上电设备会自动：
- 读取保存的WiFi配置
- 自动连接WiFi
- 同步NTP时间
- 拍摄照片并保存到TF卡
- 进入深度睡眠10分钟
- 循环执行

## 照片文件

照片保存在TF卡根目录，文件名格式为：`YYYY_MM_DD_HH:MM.jpg`

例如：
- `2025_01_15_14:30.jpg`
- `2025_01_15_14:45.jpg`
- `2025_01_15_15:00.jpg`

## 分辨率说明

- **有PSRAM的ESP32-CAM**：UXGA (1600x1200)
- **无PSRAM的ESP32-CAM**：SVGA (800x600)

## 故障排除

### SD卡无法识别
- 确保使用格式化为FAT32的SD卡
- 检查SD卡是否插入正确
- 尝试使用不同的SD卡

### Wi-Fi连接失败
- **首次配置**：确保已通过Web界面正确配置WiFi
- 检查WiFi名称和密码是否正确
- 确保Wi-Fi信号强度足够
- 检查路由器是否支持2.4GHz（ESP32不支持5GHz）
- 如果连接失败，设备会自动进入配置模式，可以重新配置

### 无法进入配置模式
- 清除Flash数据后重新上传程序
- 检查串口监视器查看设备状态
- 确保设备正常启动（检查电源）

### 时间同步失败
- 确保Wi-Fi连接成功
- 检查网络是否能够访问NTP服务器
- 可以尝试更换NTP服务器（如：`cn.pool.ntp.org`）

### 照片质量
- 可以通过修改 `config.jpeg_quality` 调整照片质量（0-63，数值越小质量越高）
- 当前设置为10，质量较高但文件较大

## 功耗说明

使用深度睡眠模式，ESP32-CAM在睡眠时功耗极低（约10mA），适合长期运行。

## 许可证

本项目为开源项目，可自由使用和修改。

